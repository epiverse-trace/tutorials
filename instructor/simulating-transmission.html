<!DOCTYPE html>
<!-- START: inst/pkgdown/templates/layout.html --><!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><title>Epiverse-TRACE: Simulating transmission</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="../assets/styles.css"><script src="../assets/scripts.js" type="text/javascript"></script><!-- Google tag (gtag.js) --><script async src="https://www.googletagmanager.com/gtag/js?id=G-XZ471458FQ"></script><script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'G-XZ471458FQ');
    </script><!-- mathjax --><script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      config: ["MMLorHTML.js"],
      jax: ["input/TeX","input/MathML","output/HTML-CSS","output/NativeMML", "output/PreviewHTML"],
      extensions: ["tex2jax.js","mml2jax.js","MathMenu.js","MathZoom.js", "fast-preview.js", "AssistiveMML.js", "a11y/accessibility-menu.js"],
      TeX: {
        extensions: ["AMSmath.js","AMSsymbols.js","noErrors.js","noUndefined.js"]
      },
      tex2jax: {
        inlineMath: [['\\(', '\\)']],
        displayMath: [ ['$$','$$'], ['\\[', '\\]'] ],
        processEscapes: true
      }
    });
    </script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><!-- Responsive Favicon for The Carpentries --><link rel="apple-touch-icon" sizes="180x180" href="../apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png"><link rel="manifest" href="../site.webmanifest"><link rel="mask-icon" href="../safari-pinned-tab.svg" color="#5bbad5"><meta name="msapplication-TileColor" content="#da532c"><meta name="theme-color" content="#ffffff"></head><body>
    <header id="top" class="navbar navbar-expand-md navbar-light bg-white top-nav incubator"><a class="visually-hidden-focusable skip-link" href="#main-content">Skip to main content</a>
  <div class="container-fluid top-nav-container">
    <div class="col-md-6">
      <div class="large-logo">
        <img alt="Epiverse-TRACE" src="../assets/images/epiverse-logo.svg"><abbr class="badge badge-light" title="This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught." style="background-color: #FF4955; border-radius: 5px">
          <a href="https://cdh.carpentries.org/the-lesson-life-cycle.html#early-development-pre-alpha-through-alpha" class="external-link alert-link" style="color: #FFF">
            <i aria-hidden="true" class="icon" data-feather="alert-octagon" style="border-radius: 5px"></i>
            Pre-Alpha
          </a>
          <span class="visually-hidden">This lesson is in the pre-alpha phase, which means that it is in early development, but has not yet been taught.</span>
        </abbr>
        
      </div>
    </div>
    <div class="selector-container">
      
      
      <div class="dropdown">
        <button class="btn btn-secondary dropdown-toggle bordered-button" type="button" id="dropdownMenu1" data-bs-toggle="dropdown" aria-expanded="false">
          <i aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View <i data-feather="chevron-down"></i>
        </button>
        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1"><li><button class="dropdown-item" type="button" onclick="window.location.href='../simulating-transmission.html';">Learner View</button></li>
        </ul></div>
    </div>
  </div>
  <hr></header><nav class="navbar navbar-expand-xl navbar-light bg-white bottom-nav incubator" aria-label="Main Navigation"><div class="container-fluid nav-container">
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
      <span class="menu-title">Menu</span>
    </button>
    <div class="nav-logo">
      <img class="small-logo" alt="Epiverse-TRACE" src="../assets/images/epiverse-logo.svg"></div>
    <div class="lesson-title-md">
      Epiverse-TRACE
    </div>
    <div class="search-icon-sm">
      <!-- TODO: do not show until we have search
      <i role="img" aria-label="search button" data-feather="search"></i>
      -->
    </div>
    <div class="desktop-nav">
      <ul class="navbar-nav me-auto mb-2 mb-lg-0"><li class="nav-item">
          <span class="lesson-title">
            Epiverse-TRACE
          </span>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/key-points.html">Key Points</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/instructor-notes.html">Instructor Notes</a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="../instructor/images.html">Extract All Images</a>
        </li>
        <li class="nav-item dropdown">
          <button class="nav-link dropdown-toggle" id="navbarDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            More <i data-feather="chevron-down"></i>
          </button>
          <ul class="dropdown-menu" aria-labelledby="navbarDropdown"></ul></li>
      </ul></div>
    <form class="d-flex col-md-2 search-form">
      <fieldset disabled><input class="form-control me-2 searchbox" type="search" placeholder="Search" aria-label="Search"><button class="btn btn-outline-success tablet-search-button" type="submit">
          <i class="search-icon" data-feather="search" role="img" aria-label="search button"></i>
        </button>
      </fieldset></form>
  </div><!--/div.container-fluid -->
</nav><div class="col-md-12 mobile-title">
  Epiverse-TRACE
</div>

<aside class="col-md-12 lesson-progress"><div style="width: 0%" class="percentage">
    0%
  </div>
  <div class="progress incubator">
    <div class="progress-bar incubator" role="progressbar" style="width: 0%" aria-valuenow="0" aria-label="Lesson Progress" aria-valuemin="0" aria-valuemax="100">
    </div>
  </div>
</aside><div class="container">
      <div class="row">
        <!-- START: inst/pkgdown/templates/navbar.html -->
<div id="sidebar-col" class="col-lg-4">
  <div id="sidebar" class="sidebar">
      <nav aria-labelledby="flush-headingEleven"><button role="button" aria-label="close menu" alt="close menu" aria-expanded="true" aria-controls="sidebar" class="collapse-toggle">
          <i class="search-icon" data-feather="x" role="img"></i>
        </button>
        <div class="sidebar-inner">
          <div class="row mobile-row">
            <div class="col">
              <div class="sidenav-view-selector">
                <div class="accordion accordion-flush" id="accordionFlush9">
                  <div class="accordion-item">
                    <h2 class="accordion-header" id="flush-headingNine">
                      <button class="accordion-button collapsed" id="instructor" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseNine" aria-expanded="false" aria-controls="flush-collapseNine">
                        <i id="eye" aria-hidden="true" class="icon" data-feather="eye"></i> Instructor View
                      </button>
                    </h2>
                    <div id="flush-collapseNine" class="accordion-collapse collapse" aria-labelledby="flush-headingNine" data-bs-parent="#accordionFlush2">
                      <div class="accordion-body">
                        <a href="../simulating-transmission.html">Learner View</a>
                      </div>
                    </div>
                  </div><!--/div.accordion-item-->
                </div><!--/div.accordion-flush-->
              </div><!--div.sidenav-view-selector -->
            </div><!--/div.col -->
      
            <hr></div><!--/div.mobile-row -->

          <div class="accordion accordion-flush" id="accordionFlush11">
            <div class="accordion-item">

              <button id="chapters" class="accordion-button show" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseEleven" aria-expanded="false" aria-controls="flush-collapseEleven">
                <h2 class="accordion-header chapters" id="flush-headingEleven">
                  EPISODES
                </h2>
              </button>
              <div id="flush-collapseEleven" class="accordion-collapse show collapse" aria-labelledby="flush-headingEleven" data-bs-parent="#accordionFlush11">

                <div class="accordion-body">
                  <div class="accordion accordion-flush" id="accordionFlush1">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading1">
        <a href="index.html">Summary and Schedule</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlushcurrent">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-headingcurrent">
      <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapsecurrent" aria-expanded="true" aria-controls="flush-collapsecurrent">
        <span class="visually-hidden">Current Chapter</span>
        <span class="current-chapter">
        1. Simulating transmission
        </span>
      </button>
    </div><!--/div.accordion-header-->
        
    <div id="flush-collapsecurrent" class="accordion-collapse collapse show" aria-labelledby="flush-headingcurrent" data-bs-parent="#accordionFlushcurrent">
      <div class="accordion-body">
        <ul><li><a href="#introduction">Introduction</a></li>
<li><a href="#model-structures">Model structures</a></li>
<li><a href="#model-parameters">Model parameters</a></li>
<li><a href="#generating-trajectories">Generating trajectories</a></li>
<li><a href="#summary">Summary</a></li>
        </ul></div><!--/div.accordion-body-->
    </div><!--/div.accordion-collapse-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush3">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading3">
        <a href="model-choices.html">2. Choosing an appropriate model</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush4">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading4">
        <a href="modelling-interventions.html">3. Modelling interventions</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

<div class="accordion accordion-flush" id="accordionFlush5">
  <div class="accordion-item">
    <div class="accordion-header" id="flush-heading5">
        <a href="compare-interventions.html">4. Comparing public health outcomes of interventions</a>
    </div><!--/div.accordion-header-->
        
  </div><!--/div.accordion-item-->
</div><!--/div.accordion-flush-->

                </div>
              </div>
            </div>

            <hr class="half-width"><div class="accordion accordion-flush resources" id="accordionFlush12">
              <div class="accordion-item">
                <h2 class="accordion-header" id="flush-headingTwelve">
                  <button class="accordion-button collapsed" id="resources" type="button" data-bs-toggle="collapse" data-bs-target="#flush-collapseTwelve" aria-expanded="false" aria-controls="flush-collapseTwelve">
                    RESOURCES
                  </button>
                </h2>
                <div id="flush-collapseTwelve" class="accordion-collapse collapse" aria-labelledby="flush-headingTwelve" data-bs-parent="#accordionFlush12">
                  <div class="accordion-body">
                    <ul><li>
                        <a href="../instructor/key-points.html">Key Points</a>
                      </li>
                      <li>
                        <a href="../instructor/instructor-notes.html">Instructor Notes</a>
                      </li>
                      <li>
                        <a href="../instructor/images.html">Extract All Images</a>
                      </li>
                      
                    </ul></div>
                </div>
              </div>
            </div>
            <hr class="half-width resources"><a href="../instructor/aio.html">See all in one page</a>
            

            <hr class="d-none d-sm-block d-md-none"><div class="d-grid gap-1">
            
            </div>
          </div><!-- /div.accordion -->
        </div><!-- /div.sidebar-inner -->
      </nav></div><!-- /div.sidebar -->
  </div><!-- /div.sidebar-col -->
<!-- END:   inst/pkgdown/templates/navbar.html-->

        <!-- START: inst/pkgdown/templates/content-instructor.html -->
  <div class="col-xl-8 col-lg-12 primary-content">
    <nav class="lesson-content mx-md-4" aria-label="Previous and Next Chapter"><!-- content for small screens --><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/index.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/model-choices.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/index.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Home
        </a>
        <a class="chapter-link float-end" href="../instructor/model-choices.html" rel="next">
          Next: Choosing an... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
      <hr></nav><main id="main-content" class="main-content"><div class="container lesson-content">
        <h1>Simulating transmission</h1>
        <p> Last updated on 2023-12-13 | 
        
        <a href="https://github.com/epiverse-trace/tutorials/edit/main/episodes/simulating-transmission.Rmd" class="external-link">Edit this page <i aria-hidden="true" data-feather="edit"></i></a></p>
        
        
        
        <p>Estimated time <i aria-hidden="true" data-feather="clock"></i> 75 minutes </p>
        
        <div class="text-end">
          <button role="button" aria-pressed="false" tabindex="0" id="expand-code" class="pull-right"> Expand All Solutions <i aria-hidden="true" data-feather="plus"></i></button>
        </div>

        

<div class="overview card">
<h2 class="card-header">Overview</h2>
<div class="row g-0">
<div class="col-md-4">
<div class="card-body">
<div class="inner">
<h3 class="card-title">Questions</h3>
<ul><li>How do I generate predictions of disease trajectories?</li>
<li>What inputs are needed for a model simulation?</li>
</ul></div>
</div>
</div>
<div class="col-md-8">
<div class="card-body">
<div class="inner bordered">
<h3 class="card-title">Objectives</h3>
<p>Using the R package <code>epidemics</code>, learn how to:</p>
<ul><li>load an existing model structure,</li>
<li>load an existing social contact matrix,</li>
<li>run a model simulation.</li>
</ul></div>
</div>
</div>
</div>
</div>
<div id="prerequisites" class="callout prereq">
<div class="callout-square">
<i class="callout-icon" data-feather="check"></i>
</div>
<div id="prerequisites" class="callout-inner">
<h3 class="callout-title">Prerequisites<a class="anchor" aria-label="anchor" href="#prerequisites"></a>
</h3>
<div class="callout-content">
<p>This tutorial has the following concept dependencies:</p>
<p><strong>Modelling</strong> : <a href="https://doi.org/10.1038/s41592-020-0856-2" class="external-link">Components of
infectious disease models</a> e.g. state variables, parameters, initial
conditions, and ordinary differential equations.</p>
<p><strong>Epidemic theory</strong> : <a href="https://doi.org/10.1155/2011/267049" class="external-link">Transmission</a>, <a href="https://doi.org/10.3201/eid2501.171901" class="external-link">Reproduction
number</a>.</p>
</div>
</div>
</div>
<section id="introduction"><h2 class="section-heading">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<hr class="half-width"><p>Mathematical models are useful tools for generating future
trajectories of disease spread. Models can be used to evaluate the
implementation of non-pharmaceutical and pharmaceutical interventions
while accounting for factors such as age.</p>
<p>In this tutorial, we will use the R package <code>{epidemics}</code>
to generate trajectories of influenza spread. By the end of this
tutorial, you will be able to generate the trajectory below showing the
number of infectious individuals in different age categories over
time.</p>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in infection(name = "influenza", r0 = 1.46, preinfectious_period = 3, : could not find function "infection"</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in model_default_cpp(population = uk_population, infection = influenza, : unused argument (infection = influenza)</code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'output' not found</code></pre>
</div>
<div id="accordionInstructor1" class="accordion instructor-note accordion-flush">
<div class="accordion-item">
<button class="accordion-button instructor-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseInstructor1" aria-expanded="false" aria-controls="collapseInstructor1">
  <h3 class="accordion-header" id="headingInstructor1">
  <div class="note-square"><i aria-hidden="true" class="callout-icon" data-feather="edit-2"></i></div>
  Instructor Note
  </h3>
</button>
<div id="collapseInstructor1" class="accordion-collapse collapse" data-bs-parent="#accordionInstructor1" aria-labelledby="headingInstructor1">
<div class="accordion-body">
<p>By the end of this tutorial, learners should be able to replicate the
above image on their own computers.</p>
</div>
</div>
</div>
</div>
<p>The first step is to install the R packages
<code>epidemics</code>.</p>
<div class="codewrapper sourceCode" id="cb4">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw">if</span> <span class="op">(</span><span class="op">!</span><span class="kw">require</span><span class="op">(</span><span class="st">"pak"</span><span class="op">)</span><span class="op">)</span> <span class="fu">install.packages</span><span class="op">(</span><span class="st">"pak"</span><span class="op">)</span></span>
<span><span class="fu">pak</span><span class="fu">::</span><span class="fu">pak</span><span class="op">(</span><span class="st">"epiverse-trace/epidemics"</span><span class="op">)</span></span></code></pre>
</div>
</section><section id="model-structures"><h2 class="section-heading">Model structures<a class="anchor" aria-label="anchor" href="#model-structures"></a>
</h2>
<hr class="half-width"><p>To generate predictions of infectious disease trajectories, we must
first select a mathematical model to use. There is a library of models
to choose from in <code>epidemics</code>. Models in
<code>epidemics</code> are prefixed with <code>model</code> and suffixed
by the name of infection (e.g. ebola) or a different identifier
(e.g. default), and whether the model has a R or C++ code base. In this
tutorial, we will use the default epidemic model,
<code>model_default_cpp()</code> which is described in the next
section.</p>
<div id="check-model-equations" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="check-model-equations" class="callout-inner">
<h3 class="callout-title">Check model equations<a class="anchor" aria-label="anchor" href="#check-model-equations"></a>
</h3>
<div class="callout-content">
<p>When using existing model structures always check the model
assumptions. Ask questions such as:</p>
<ul><li>How is transmission modelled? e.g. <a href="reference.html#direct">direct</a> or <a href="reference.html#indirect">indirect</a>, <a href="reference.html#airborne">airborne</a> or <a href="reference.html#vectorborne">vector-borne</a>?</li>
<li>What interventions are modelled?</li>
<li>What state variables are there and how do they relate to assumptions
about infection?</li>
</ul><p>There can be subtle differences in model structures for the same
infection or outbreak type which can be missed without studying the
equations.</p>
</div>
</div>
</div>
<div class="section level3">
<h3 id="an-epidemic-model-for-pandemic-influenza">An epidemic model for pandemic influenza<a class="anchor" aria-label="anchor" href="#an-epidemic-model-for-pandemic-influenza"></a></h3>
<p>We want to generate disease trajectories of an influenza strain with
pandemic potential. We will use the default epidemic model in
<code>epidemics</code>, an age-structured SEIR model described by a
system of ordinary differential equations. For each age group <span class="math inline">\(i\)</span>, individuals are classed as either
susceptible <span class="math inline">\(S\)</span>, infected but not yet
infectious <span class="math inline">\(E\)</span>, infectious <span class="math inline">\(I\)</span> or recovered <span class="math inline">\(R\)</span>.</p>
<figure><img src="../fig/simulating-transmission-rendered-diagram-1.png" style="display: block; margin: auto;" class="figure mx-auto d-block"></figure><p>The model parameters and equations are as follows :</p>
<ul><li>transmission rate <span class="math inline">\(\beta\)</span>,</li>
<li>contact matrix <span class="math inline">\(C\)</span> containing the
frequency of contacts between age groups (a square <span class="math inline">\(i \times j\)</span> matrix),</li>
<li>rate of transition from exposed to infectious <span class="math inline">\(\alpha\)</span> (preinfectious period=<span class="math inline">\(1/\alpha\)</span>),</li>
<li>recovery rate <span class="math inline">\(\gamma\)</span>
(infectious period = <span class="math inline">\(1/\gamma\)</span>).</li>
</ul><p><span class="math display">\[
\begin{aligned}
\frac{dS_i}{dt} &amp; = - \beta S_i \sum_j C_{i,j} I_j \\
\frac{dE_i}{dt} &amp;= \beta S_i\sum_j C_{i,j} I_j - \alpha E_i \\
\frac{dI_i}{dt} &amp;= \alpha E_i - \gamma I_i \\
\frac{dR_i}{dt} &amp;=\gamma I_i \\
\end{aligned}
\]</span></p>
<p>The <em>contact matrix</em> is a square matrix consisting of
rows/columns equal to the number age groups. Each element represents the
frequency of contacts between age groups. If we believe that
transmission of an infection is driven by contact, and that contact
rates are very different for different age groups, then specifying a
contact matrix allows us to account for age specific rates of
transmission.</p>
<p>From the model structure we see that :</p>
<ul><li>the contact matrix <span class="math inline">\(C\)</span> allows for
heterogeneity in contacts between age groups,</li>
<li>there is no loss of immunity (there are no flows out of the
recovered state).</li>
</ul><p>This model also has the functionality to include vaccination and
tracks the number of vaccinated individuals through time. We will cover
the use of interventions in future tutorials.</p>
<div id="exposed-infected-infectious" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="exposed-infected-infectious" class="callout-inner">
<h3 class="callout-title">Exposed, infected, infectious<a class="anchor" aria-label="anchor" href="#exposed-infected-infectious"></a>
</h3>
<div class="callout-content">
<p>Confusion sometimes arises when referring to the terms ‘exposed’,
‘infected’ and ‘infectious’ in mathematical modelling. Infection occurs
after a person has been exposed, but in modelling terms individuals that
are ‘exposed’ are treated as already infected.</p>
<p>We will use the following definitions for our state variables:</p>
<ul><li>
<span class="math inline">\(E\)</span> = Exposed : infected
<strong>but not yet</strong> infectious,</li>
<li>
<span class="math inline">\(I\)</span> = Infectious: infected
<strong>and</strong> infectious.</li>
</ul></div>
</div>
</div>
<p>To generate trajectories using our model, we need the following :</p>
<ol style="list-style-type: decimal"><li>parameter values,</li>
<li>contact matrix,</li>
<li>demographic structure,</li>
<li>initial conditions.</li>
</ol></div>
</section><section id="model-parameters"><h2 class="section-heading">Model parameters<a class="anchor" aria-label="anchor" href="#model-parameters"></a>
</h2>
<hr class="half-width"><p>To run our model we need to specify the model parameters:</p>
<ul><li>transmission rate <span class="math inline">\(\beta\)</span>,</li>
<li>rate of transition from exposed to infectious <span class="math inline">\(\alpha\)</span> (preinfectious period=<span class="math inline">\(1/\alpha\)</span>),</li>
<li>recovery rate <span class="math inline">\(\gamma\)</span>
(infectious period=<span class="math inline">\(1/\gamma\)</span>).</li>
</ul><p>We will learn how to specify the contact matrix <span class="math inline">\(C\)</span> in the next section.</p>
<p>We will simulate a strain of influenza with pandemic potential with
<span class="math inline">\(R_0=1.5\)</span>, a preinfectious period of
3 days and infectious period of 7 days.</p>
<p>In <code>epidemics</code>, we use the function
<code>infection()</code> to create an infection object containing the
values of, <span class="math inline">\(R_0\)</span>, the preinfectious
period (<span class="math inline">\(1/\alpha\)</span>) and the
infectious period (<span class="math inline">\(1/\gamma\)</span>) as
follows.</p>
<div class="codewrapper sourceCode" id="cb5">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">influenza</span> <span class="op">&lt;-</span> <span class="fu">infection</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"influenza"</span>,</span>
<span>  r0 <span class="op">=</span> <span class="fl">1.5</span>,</span>
<span>  preinfectious_period <span class="op">=</span> <span class="fl">3</span>,</span>
<span>  infectious_period <span class="op">=</span> <span class="fl">7</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div id="the-basic-reproduction-number-r_0" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="the-basic-reproduction-number-r_0" class="callout-inner">
<h3 class="callout-title">The basic reproduction number <span class="math inline">\(R_0\)</span><a class="anchor" aria-label="anchor" href="#the-basic-reproduction-number-r_0"></a>
</h3>
<div class="callout-content">
<p>The basic reproduction number, <span class="math inline">\(R_0\)</span>, for the SEIR model is:</p>
<p><span class="math display">\[ R_0 =
\frac{\beta}{\gamma}.\]</span></p>
<p>Therefore, we can rewrite the transmission rate, <span class="math inline">\(\beta\)</span>, as:</p>
<p><span class="math display">\[ \beta = R_0 \gamma.\]</span></p>
</div>
</div>
</div>
<!-- ### Load parameters from previous tutorials  -->
<div class="section level3">
<h3 id="contact-matrix">Contact matrix<a class="anchor" aria-label="anchor" href="#contact-matrix"></a></h3>
<p>Contact matrices can be estimated from surveys or contact data, or
synthetic ones can be used. We will use the R package
<a href="https://github.com/epiforecasts/socialmixr" class="external-link">socialmixr</a> to load in a contact matrix estimated from
POLYMOD survey data <a href="https://doi.org/10.1371/journal.pmed.0050074" class="external-link">(Mossong et
al. 2008)</a>.</p>
<div id="load-contact-and-population-data" class="callout challenge">
<div class="callout-square">
<i class="callout-icon" data-feather="zap"></i>
</div>
<div id="load-contact-and-population-data" class="callout-inner">
<h3 class="callout-title">Load contact and population data<a class="anchor" aria-label="anchor" href="#load-contact-and-population-data"></a>
</h3>
<div class="callout-content">
<p>Using the R package <code>socialmixr</code>, run the following lines
of R code to obtain the contact matrix for the United Kingdom for the
year age bins:</p>
<ul><li>age between 0 and 20 years,</li>
<li>age between 20 and 40,</li>
<li>40 years and over.</li>
</ul><div class="codewrapper sourceCode" id="cb6">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">polymod</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="va">polymod</span></span>
<span><span class="va">contact_data</span> <span class="op">&lt;-</span> <span class="fu">socialmixr</span><span class="fu">::</span><span class="fu">contact_matrix</span><span class="op">(</span></span>
<span>  survey <span class="op">=</span> <span class="va">polymod</span>,</span>
<span>  countries <span class="op">=</span> <span class="st">"United Kingdom"</span>,</span>
<span>  age.limits <span class="op">=</span> <span class="fu">c</span><span class="op">(</span><span class="fl">0</span>, <span class="fl">20</span>, <span class="fl">40</span><span class="op">)</span>,</span>
<span>  symmetric <span class="op">=</span> <span class="cn">TRUE</span></span>
<span><span class="op">)</span></span>
<span><span class="co"># prepare contact matrix</span></span>
<span><span class="va">contact_matrix</span> <span class="op">&lt;-</span> <span class="fu">t</span><span class="op">(</span><span class="va">contact_data</span><span class="op">$</span><span class="va">matrix</span><span class="op">)</span></span>
<span><span class="va">contact_matrix</span></span></code></pre>
</div>
</div>
</div>
</div>
<div id="accordionSolution1" class="accordion challenge-accordion accordion-flush">
<div class="accordion-item">
<button class="accordion-button solution-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#collapseSolution1" aria-expanded="false" aria-controls="collapseSolution1">
  <h4 class="accordion-header" id="headingSolution1">
  Output
  </h4>
</button>
<div id="collapseSolution1" class="accordion-collapse collapse" data-bs-parent="#accordionSolution1" aria-labelledby="headingSolution1">
<div class="accordion-body">
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>                 
contact.age.group     [,1]     [,2]     [,3]
          [0,20)  7.883663 2.794154 1.565665
          [20,40) 3.120220 4.854839 2.624868
          40+     3.063895 4.599893 5.005571</code></pre>
</div>
</div>
</div>
</div>
</div>
<p>The result is a square matrix with rows and columns for each age
group. Contact matrices can be loaded from other sources, but they must
be in the correct format to be used in <code>epidemics</code>.</p>
<div id="why-would-a-contact-matrix-be-non-symmetric" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="why-would-a-contact-matrix-be-non-symmetric" class="callout-inner">
<h3 class="callout-title">Why would a contact matrix be
non-symmetric?<a class="anchor" aria-label="anchor" href="#why-would-a-contact-matrix-be-non-symmetric"></a>
</h3>
<div class="callout-content">
<p>One of the arguments of the function <code>contact_matrix()</code> is
<code>symmetric=TRUE</code>. This means that the total number of
contacts of age group 1 with age group 2, should be the same as the
total number of contacts of age group 2 and age group 1 (see the
<code>socialmixr</code> <a href="https://cran.r-project.org/web/packages/socialmixr/vignettes/socialmixr.html" class="external-link">vignette</a>
for more detail). However, when contact matrices are estimated from
surveys or other sources, the <em>reported</em> number of contacts may
differ by age group resulting in a non-symmetric contact matrix <a href="https://doi.org/10.1371/journal.pcbi.1009098" class="external-link">(Prem et al
2021)</a>.</p>
</div>
</div>
</div>
</div>
</section><section id="generating-trajectories"><h2 class="section-heading">Generating trajectories<a class="anchor" aria-label="anchor" href="#generating-trajectories"></a>
</h2>
<hr class="half-width"><p>We have prepared our parameter values, contact matrix and demography
vector. Now we must set the initial conditions, prepare the population
and run the model.</p>
<div class="section level3">
<h3 id="initial-conditions">Initial conditions<a class="anchor" aria-label="anchor" href="#initial-conditions"></a></h3>
<p>The initial conditions are the proportion of individuals in each
disease state <span class="math inline">\(S\)</span>, <span class="math inline">\(E\)</span>, <span class="math inline">\(I\)</span>
and <span class="math inline">\(R\)</span> for each age group at time 0.
In this example, we have three age groups age between 0 and 20 years,
age between 20 and 40 years and over. Let’s assume that in the youngest
age category, one in a million individuals are infectious, and the
remaining age categories are infection free.</p>
<p>The initial conditions in the first age category are <span class="math inline">\(S(0)=1-\frac{1}{1,000,000}\)</span>, <span class="math inline">\(E(0) =0\)</span>, <span class="math inline">\(I(0)=\frac{1}{1,000,000}\)</span>, <span class="math inline">\(R(0)=0\)</span>. This is specified as a vector as
follows:</p>
<div class="codewrapper sourceCode" id="cb8">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_i</span> <span class="op">&lt;-</span> <span class="fl">1e-6</span></span>
<span><span class="va">initial_conditions_inf</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span></span>
<span>  S <span class="op">=</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">initial_i</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="va">initial_i</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>For the age categories that are free from infection, the initial
conditions are <span class="math inline">\(S(0)=1\)</span>, <span class="math inline">\(E(0) =0\)</span>, <span class="math inline">\(I(0)=0\)</span>, <span class="math inline">\(R(0)=0\)</span>. We specify this as follows,</p>
<div class="codewrapper sourceCode" id="cb9">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">initial_conditions_free</span> <span class="op">&lt;-</span> <span class="fu">c</span><span class="op">(</span></span>
<span>  S <span class="op">=</span> <span class="fl">1</span>, E <span class="op">=</span> <span class="fl">0</span>, I <span class="op">=</span> <span class="fl">0</span>, R <span class="op">=</span> <span class="fl">0</span>, V <span class="op">=</span> <span class="fl">0</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>We combine the three initial conditions vectors into one matrix,</p>
<div class="codewrapper sourceCode" id="cb10">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># build for all age groups</span></span>
<span><span class="va">initial_conditions</span> <span class="op">&lt;-</span> <span class="fu">rbind</span><span class="op">(</span></span>
<span>  <span class="va">initial_conditions_inf</span>,</span>
<span>  <span class="va">initial_conditions_free</span>,</span>
<span>  <span class="va">initial_conditions_free</span></span>
<span><span class="op">)</span></span>
<span><span class="fu">rownames</span><span class="op">(</span><span class="va">initial_conditions</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span>
<span><span class="va">initial_conditions</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>               S E     I R V
[0,20)  0.999999 0 1e-06 0 0
[20,40) 1.000000 0 0e+00 0 0
40+     1.000000 0 0e+00 0 0</code></pre>
</div>
</div>
<div class="section level3">
<h3 id="running-the-model">Running the model<a class="anchor" aria-label="anchor" href="#running-the-model"></a></h3>
<p>To run the model we need the following inputs:</p>
<ul><li>an infection object,</li>
<li>a population object,</li>
<li>an optional number of time steps.</li>
</ul><p>We have already created our infection object <code>influenza</code>.
The population object requires a vector containing the demographic
structure of the population. The demographic vector must be a named
vector containing the number of individuals in each age group of our
given population. In this example, we can extract the demographic
information from the <code>contact_data</code> object that we obtained
using the <code>socialmixr</code> package.</p>
<div class="codewrapper sourceCode" id="cb12">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">demography_vector</span> <span class="op">&lt;-</span> <span class="va">contact_data</span><span class="op">$</span><span class="va">demography</span><span class="op">$</span><span class="va">population</span></span>
<span><span class="fu">names</span><span class="op">(</span><span class="va">demography_vector</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span></span>
<span><span class="va">demography_vector</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">OUTPUT<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="output" tabindex="0"><code>  [0,20)  [20,40)      40+ 
14799290 16526302 28961159 </code></pre>
</div>
<p>To create our population object, we call the function
<code>population()</code> specifying a name, the contact matrix, the
demography vector and the initial conditions.</p>
<div class="codewrapper sourceCode" id="cb14">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uk_population</span> <span class="op">&lt;-</span> <span class="fu">population</span><span class="op">(</span></span>
<span>  name <span class="op">=</span> <span class="st">"UK"</span>,</span>
<span>  contact_matrix <span class="op">=</span> <span class="va">contact_matrix</span>,</span>
<span>  demography_vector <span class="op">=</span> <span class="va">demography_vector</span>,</span>
<span>  initial_conditions <span class="op">=</span> <span class="va">initial_conditions</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<p>No we are ready to run our model. We will specify
<code>time_end=600</code> to run the model for 600 days.</p>
<div class="codewrapper sourceCode" id="cb15">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model_default_cpp</span><span class="op">(</span></span>
<span>  population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>  infection <span class="op">=</span> <span class="va">influenza</span>,</span>
<span>  time_end <span class="op">=</span> <span class="fl">600</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in model_default_cpp(population = uk_population, infection = influenza, : unused argument (infection = influenza)</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb17">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">head</span><span class="op">(</span><span class="va">output</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'output' not found</code></pre>
</div>
<p>Our model output consists of the number of individuals in each
compartment in each age group through time. We can visualise the
infectious individuals only (those in the <span class="math inline">\(I\)</span> class) through time.</p>
<div class="codewrapper sourceCode" id="cb19">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">output</span><span class="op">[</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span>, <span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">geom_line</span><span class="op">(</span></span>
<span>    <span class="fu">aes</span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span>, colour <span class="op">=</span> <span class="va">demography_group</span><span class="op">)</span>,</span>
<span>    linewidth <span class="op">=</span> <span class="fl">1</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_colour_brewer</span><span class="op">(</span></span>
<span>    palette <span class="op">=</span> <span class="st">"Dark2"</span>,</span>
<span>    labels <span class="op">=</span> <span class="fu">rownames</span><span class="op">(</span><span class="va">contact_matrix</span><span class="op">)</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Age group"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">scale_y_continuous</span><span class="op">(</span></span>
<span>    labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va">comma</span>,</span>
<span>    name <span class="op">=</span> <span class="st">"Infectious indivduals"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">labs</span><span class="op">(</span></span>
<span>    x <span class="op">=</span> <span class="st">"Model time (days)"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_classic</span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme</span><span class="op">(</span></span>
<span>    legend.position <span class="op">=</span> <span class="st">"top"</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_grey</span><span class="op">(</span></span>
<span>    base_size <span class="op">=</span> <span class="fl">15</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'output' not found</code></pre>
</div>
<div id="time-increments" class="callout callout">
<div class="callout-square">
<i class="callout-icon" data-feather="bell"></i>
</div>
<div id="time-increments" class="callout-inner">
<h3 class="callout-title">Time increments<a class="anchor" aria-label="anchor" href="#time-increments"></a>
</h3>
<div class="callout-content">
<p>Note that there is a default argument of <code>increment = 1</code>.
This relates to the time step of the ODE solver. When the parameters and
maximum number of time steps is days, the default increment is one
day.</p>
<p>The choice of increment will depend on the time scale of the
parameters, and the rate at which events can occur. In general, the
increment should smaller than the fastest event. For example, if
parameters are on a monthly time scale, but some events will occur
within a month, then the increment should be less than one month.</p>
</div>
</div>
</div>
</div>
<div class="section level3">
<h3 id="accounting-for-uncertainty">Accounting for uncertainty<a class="anchor" aria-label="anchor" href="#accounting-for-uncertainty"></a></h3>
<p>As the epidemic model is <a href="reference.html#deterministic">deterministic</a>, we have one
trajectory for our given parameter values. In practice, we have
uncertainty in the value of our parameters. To account for this, we must
run our model for different parameter combinations.</p>
<p>We ran our model with <span class="math inline">\(R_0= 1.5\)</span>.
However, we believe that <span class="math inline">\(R_0\)</span>
follows a normal distribution with mean 1.5 and standard deviation 0.05.
To account for uncertainty we will run the model for different values of
<span class="math inline">\(R_0\)</span>. The steps we will follow to do
this are:</p>
<ol style="list-style-type: decimal"><li>Obtain 100 samples from the from a normal distribution</li>
</ol><div class="codewrapper sourceCode" id="cb21">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">R0_vec</span> <span class="op">&lt;-</span> <span class="fu">rnorm</span><span class="op">(</span><span class="fl">100</span>, <span class="fl">1.5</span>, <span class="fl">0.05</span><span class="op">)</span></span></code></pre>
</div>
<ol start="2" style="list-style-type: decimal"><li>Run the model 100 times with <span class="math inline">\(R_0\)</span> equal to a different sample each
time</li>
</ol><div class="codewrapper sourceCode" id="cb22">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">output_samples</span> <span class="op">&lt;-</span> <span class="fu">Map</span><span class="op">(</span></span>
<span> <span class="va">R0_vec</span>,</span>
<span>  <span class="fu">seq_along</span><span class="op">(</span><span class="va">R0_vec</span><span class="op">)</span>,</span>
<span>  f <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span>, <span class="va">i</span><span class="op">)</span> <span class="op">{</span></span>
<span>  <span class="co"># create infection object for R0 value</span></span>
<span>    <span class="va">influenza</span> <span class="op">&lt;-</span> <span class="fu">infection</span><span class="op">(</span></span>
<span>      name <span class="op">=</span> <span class="st">"influenza"</span>,</span>
<span>      r0 <span class="op">=</span> <span class="va">x</span>,</span>
<span>      preinfectious_period <span class="op">=</span> <span class="fl">3</span>,</span>
<span>      infectious_period <span class="op">=</span> <span class="fl">7</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># run an epidemic model using `epidemic()`</span></span>
<span>    <span class="va">output</span> <span class="op">&lt;-</span> <span class="fu">model_default_cpp</span><span class="op">(</span></span>
<span>      population <span class="op">=</span> <span class="va">uk_population</span>,</span>
<span>      infection <span class="op">=</span> <span class="va">influenza</span>,</span>
<span>      time_end <span class="op">=</span> <span class="fl">600</span>, increment <span class="op">=</span> <span class="fl">1.0</span></span>
<span>    <span class="op">)</span></span>
<span></span>
<span>    <span class="co"># extract infectious individuals </span></span>
<span>    <span class="va">output</span> <span class="op">&lt;-</span> <span class="va">output</span><span class="op">[</span><span class="va">compartment</span> <span class="op">==</span> <span class="st">"infectious"</span><span class="op">]</span></span>
<span></span>
<span>    <span class="co"># assign scenario number</span></span>
<span>    <span class="va">output</span><span class="op">[</span>, <span class="fu">c</span><span class="op">(</span><span class="st">"scenario"</span>, <span class="st">"R"</span><span class="op">)</span> <span class="op">:=</span> <span class="fu">list</span><span class="op">(</span><span class="va">i</span>, <span class="va">x</span><span class="op">)</span><span class="op">]</span></span>
<span></span>
<span>    <span class="va">output</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in infection(name = "influenza", r0 = x, preinfectious_period = 3, : could not find function "infection"</code></pre>
</div>
<div class="codewrapper sourceCode" id="cb24">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># combine to prepare for plotting</span></span>
<span><span class="va">output_samples</span> <span class="op">&lt;-</span> <span class="fu">bind_rows</span><span class="op">(</span><span class="va">output_samples</span><span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'output_samples' not found</code></pre>
</div>
<ol start="3" style="list-style-type: decimal"><li>Calculate the mean and 95% quantiles of number of infectious
individuals across each model simulation and visualise output</li>
</ol><div class="codewrapper sourceCode" id="cb26">
<h3 class="code-label">R<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">ggplot</span><span class="op">(</span><span class="va">output_samples</span> ,<span class="fu">aes</span><span class="op">(</span><span class="va">time</span>, <span class="va">value</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"line"</span>, fun <span class="op">=</span> <span class="va">mean</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">stat_summary</span><span class="op">(</span>geom <span class="op">=</span> <span class="st">"ribbon"</span>, </span>
<span>               fun.min <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span> <span class="fu">quantile</span><span class="op">(</span><span class="va">z</span>, <span class="fl">0.025</span><span class="op">)</span> <span class="op">}</span>,</span>
<span>               fun.max <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">z</span><span class="op">)</span> <span class="op">{</span> <span class="fu">quantile</span><span class="op">(</span><span class="va">z</span>, <span class="fl">0.975</span><span class="op">)</span> <span class="op">}</span>, </span>
<span>               alpha <span class="op">=</span> <span class="fl">0.3</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">facet_grid</span><span class="op">(</span></span>
<span>    cols <span class="op">=</span> <span class="fu">vars</span><span class="op">(</span><span class="va">demography_group</span><span class="op">)</span></span>
<span>  <span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu">theme_grey</span><span class="op">(</span></span>
<span>    base_size <span class="op">=</span> <span class="fl">15</span></span>
<span>  <span class="op">)</span></span></code></pre>
</div>
<div class="codewrapper">
<h3 class="code-label">ERROR<i aria-hidden="true" data-feather="chevron-left"></i><i aria-hidden="true" data-feather="chevron-right"></i>
</h3>
<pre class="error" tabindex="0"><code>Error in eval(expr, envir, enclos): object 'output_samples' not found</code></pre>
</div>
<p>Deciding which parameters to include uncertainty in depends on a few
factors: how well informed a parameter value is e.g. consistency of
estimates from the literature; how sensitive model outputs are to
parameter value changes; and the purpose of the modelling task.</p>
</div>
</section><section id="summary"><h2 class="section-heading">Summary<a class="anchor" aria-label="anchor" href="#summary"></a>
</h2>
<hr class="half-width"><p>In this tutorial, we have learnt how to generate disease trajectories
using a mathematical model. Once a model has been chosen, the parameters
and other inputs must be specified in the correct way to perform model
simulations. In the next tutorial, we will consider how to choose the
right model for different tasks.</p>
<div id="keypoints1" class="callout keypoints">
<div class="callout-square">
<i class="callout-icon" data-feather="key"></i>
</div>
<div class="callout-inner">
<h3 class="callout-title">Keypoints<a class="anchor" aria-label="anchor" href="#keypoints1"></a>
</h3>
<div class="callout-content">
<ul><li>Disease trajectories can be generated using the R package
<code>epidemics</code>
</li>
<li>Contact matrices can be estimated from different sources</li>
<li>Include uncertainty in model trajectories</li>
</ul></div>
</div>
</div>
<!-- 
Place links that you need to refer to multiple times across pages here. Delete
any links that you are not going to use. 
 -->
</section></div> <!-- / div.lesson-content -->
    </main><!-- / main#main-content.main-content --><nav class="bottom-pagination mx-md-4" aria-label="Previous and Next Chapter"><div class="d-block d-sm-block d-md-none">
        <a class="chapter-link" href="../instructor/index.html"><i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>Previous</a>
        <a class="chapter-link float-end" href="../instructor/model-choices.html">Next<i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i></a>
      </div>
      <!-- content for large screens -->
      <div class="d-none d-sm-none d-md-block">
        <a class="chapter-link" href="../instructor/index.html" rel="prev">
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-left"></i>
          Home
        </a>
        <a class="chapter-link float-end" href="../instructor/model-choices.html" rel="next">
          Next: Choosing an... 
          <i aria-hidden="true" class="small-arrow" data-feather="arrow-right"></i>
        </a>
      </div>
    </nav></div> <!-- / div.primary-content.col-xs-12 -->
<!-- END:   inst/pkgdown/templates/content-instructor.html-->

      </div><!--/div.row-->
      		<footer class="row footer mx-md-3"><hr><div class="col-md-6">
				<p>This lesson is subject to the <a href="CODE_OF_CONDUCT.html">Code of Conduct</a></p>
        <p>
        
        <a href="https://github.com/epiverse-trace/tutorials/edit/main/episodes/simulating-transmission.Rmd" class="external-link">Edit on GitHub</a>
        
	
        | <a href="https://github.com/epiverse-trace/tutorials/blob/main/CONTRIBUTING.md" class="external-link">Contributing</a> 
        | <a href="https://github.com/epiverse-trace/tutorials/" class="external-link">Source</a></p>
				<p><a href="https://github.com/epiverse-trace/tutorials/blob/main/CITATION" class="external-link">Cite</a> | <a href="mailto:andree.valle-campos@lshtm.ac.uk">Contact</a> | <a href="https://carpentries.org/about/" class="external-link">About</a></p>
			</div>
			<div class="col-md-6">
        
        <p>Materials licensed under <a href="../LICENSE.html">CC-BY 4.0</a> by the authors</p>
        
        <p><a href="https://creativecommons.org/licenses/by-sa/4.0/" class="external-link">Template licensed under CC-BY 4.0</a> by <a href="https://carpentries.org" class="external-link">The Carpentries</a></p>
        <p>Built with <a href="https://github.com/carpentries/sandpaper/tree/patch-renv-github-bug" class="external-link">sandpaper (0.14.1)</a>,
        <a href="https://github.com/carpentries/pegboard/tree/1bc5753e917d515c3d888ce6cc013c0a680eacfc" class="external-link">pegboard (0.7.3)</a>,
      and <a href="https://github.com/epiverse-trace/varnish/tree/epiversetheme" class="external-link">varnish (0.3.3.9000)</a>.</p>
			</div>
		</footer></div> <!-- / div.container -->
	<div id="to-top">
		<a href="#top">
			<i class="search-icon" data-feather="arrow-up" role="img" aria-label="Back to top"></i><br><span class="d-none d-sm-none d-md-none d-lg-none d-xl-block">Back</span> To Top
		</a>
	</div>
  <script type="application/ld+json">
    {
  "@context": "https://schema.org",
  "@type": "TrainingMaterial",
  "@id": "https://epiverse-trace.github.io/tutorials/instructor/simulating-transmission.html",
  "dct:conformsTo": "https://bioschemas.org/profiles/TrainingMaterial/1.0-RELEASE",
  "description": "A Carpentries Lesson teaching foundational data and coding skills to researchers worldwide",
  "keywords": "forecasts, epidemic models, interventions",
  "name": "Simulating transmission",
  "creativeWorkStatus": "active",
  "url": "https://epiverse-trace.github.io/tutorials/instructor/simulating-transmission.html",
  "identifier": "https://epiverse-trace.github.io/tutorials/instructor/simulating-transmission.html",
  "dateCreated": "2023-12-17",
  "dateModified": "2023-12-13",
  "datePublished": "2023-12-19"
}

  </script><script>
		feather.replace();
	</script><!-- Matomo
    2022-11-07: we have gotten a notification that we have an overage for our
    tracking and I'm pretty sure this has to do with Workbench usage.
    Considering that I am not _currently_ using this tracking because I do not
    yet know how to access the data, I am turning this off for now.
  <script>
    var _paq = window._paq = window._paq || [];
    /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
    _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
    _paq.push(["setDomains", ["*.preview.carpentries.org","*.datacarpentry.github.io","*.datacarpentry.org","*.librarycarpentry.github.io","*.librarycarpentry.org","*.swcarpentry.github.io", "*.carpentries.github.io"]]);
    _paq.push(["setDoNotTrack", true]);
    _paq.push(["disableCookies"]);
    _paq.push(['trackPageView']);
    _paq.push(['enableLinkTracking']);
    (function() {
          var u="https://carpentries.matomo.cloud/";
          _paq.push(['setTrackerUrl', u+'matomo.php']);
          _paq.push(['setSiteId', '1']);
          var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
          g.async=true; g.src='https://cdn.matomo.cloud/carpentries.matomo.cloud/matomo.js'; s.parentNode.insertBefore(g,s);
        })();
  </script>
  End Matomo Code --></body></html><!-- END:   inst/pkgdown/templates/layout.html-->


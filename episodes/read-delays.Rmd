---
title: 'Describe case data'
teaching: 10
exercises: 2
---

:::::::::::::::::::::::::::::::::::::: questions 

- how to obtain delay distributions from a literature systematic review?
- what is the natural history of the disease?
- how long should contacts be followed?
- what is the required duration of contact tracing?
- how long should cases be isolated to reduce transmission?

- what are the epidemiological characteristics of the infection?
- what is the demographic distribution of cases?

::::::::::::::::::::::::::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::: objectives

- Explain how to use markdown with the new lesson template
- Demonstrate how to include pieces of code, figures, and nested challenge blocks

::::::::::::::::::::::::::::::::::::::::::::::::

## Systematic review of Parameters

The natural history of a disease influence the transmission dynamics. 
<!-- ref: https://www.sciencedirect.com/topics/mathematics/infectiousness -->
<!-- ref: https://www.thelancet.com/journals/lanres/article/PIIS2213-2600(22)00226-0/fulltext -->

![Definition of key time periods. From [Xiang et al, 2021](https://www.sciencedirect.com/science/article/pii/S2468042721000038)](fig/time-periods.jpg)

![Window and kinetics of SARS-CoV-2 infectiousness in recently infected contacts. From [Hakki et al, 2022](https://www.thelancet.com/journals/lanres/article/PIIS2213-2600(22)00226-0/fulltext)](fig/infectiousness-covid19.jpg)

## Find a generation time

What it is?
With which other is related? -> the serial interval

[serial interval](../learners/reference.md#serialinterval) distribution

![Serial interval of novel coronavirus (COVID-19) infections. From [Nishiura et al, 2020](https://www.ijidonline.com/article/S1201-9712(20)30119-3/fulltext)](fig/serial-interval-covid-sars.jpg)

```{r}
### 1 replace generation time from literature -----

generation_time <- dist_spec(
  mean = 3.6,
  sd = 3.1,
  max = 20,
  distribution = "lognormal"
)

# replace this assuming that this is covid
# with lognormal

epiparameter::epidist_db(
  disease = "covid",
  epi_dist = "serial",
  author = "Nishiura") %>%
  epiparameter::list_distributions()

covid_lnorm <- epiparameter::epidist_db(
  disease = "covid",
  epi_dist = "serial",
  author = "Nishiura",
  single_epidist = T) # not desired

covid_lnorm

covid_lnorm$summary_stats$mean
covid_lnorm_discrete <- epiparameter::discretise(covid_lnorm)
covid_lnorm_discrete_max <- covid_lnorm_discrete$prob_dist$q(p = 0.999)

generation_time_epiparam <- dist_spec(
  mean = covid_lnorm$summary_stats$mean,
  sd = covid_lnorm$summary_stats$sd,
  max = covid_lnorm_discrete_max,
  distribution = "lognormal"
)

epinow_estimates <- epinow(
  # cases
  reported_cases = example_confirmed[1:60],
  # delays
  generation_time = generation_time_opts(generation_time_epiparam),
  # computation
  stan = stan_opts(
    cores = 4, samples = 1000, chains = 3,
    control = list(adapt_delta = 0.99)
  )
)

base::plot(epinow_estimates)
```

## formative

```{r}
# generation time for ebola
# if not, find serial interval and use it as serial interval
```


## Find the incubation time

What it is?
With which other is related?

The natural history of a disease influence the transmission dynamics. For `{EpiNow2}`, we can specify relevant delay distributions like the [incubation period](../learners/reference.md#incubation):

![The relationship between the incubation period and serial interval. From [Nishiura 2020](https://www.ijidonline.com/article/S1201-9712(20)30119-3/fulltext)](fig/incubation-period-serial-interval.jpg)

```{r}
incubation_period <- dist_spec(
  mean = 4, sd = 2,
  max = 20, distribution = "gamma"
)
```

```{r,message=FALSE,warning=FALSE,cache=TRUE}
epinow_estimates <- epinow(
  # cases
  reported_cases = example_confirmed[1:60],
  # delays
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period),
  # computation
  stan = stan_opts(
    cores = 4, samples = 1000, chains = 3,
    control = list(adapt_delta = 0.99)
  )
)
```


```{r}
### 2 include incubation time ------

epiparameter::epidist_db(
  disease = "covid",
  epi_dist = "incubation") %>%
  epiparameter::list_distributions()

covid_incubation <- epiparameter::epidist_db(
  disease = "covid",
  epi_dist = "incubation",
  author = "Natalie",
  single_epidist = T
)

covid_incubation

covid_incubation$summary_stats$mean
covid_incubation_discrete <- epiparameter::discretise(covid_incubation)
covid_incubation_discrete_max <- covid_lnorm_discrete$prob_dist$q(p = 0.999)

incubation_time_epiparam <- dist_spec(
  mean = covid_incubation$summary_stats$mean,
  sd = covid_incubation$summary_stats$sd,
  max = covid_incubation_discrete_max,
  distribution = "lognormal"
)

epinow_estimates <- epinow(
  # cases
  reported_cases = example_confirmed[1:60],
  # generation time
  generation_time = generation_time_opts(generation_time_epiparam),
  # delays
  delays = delay_opts(incubation_time_epiparam),
  # computation
  stan = stan_opts(
    cores = 4, samples = 1000, chains = 3,
    control = list(adapt_delta = 0.99)
  )
)

base::plot(epinow_estimates)

# post calculation questions
# what have changed?
# - cases by date of infection
# - uncertainty

```

## formative

```{r}
# formative, now with ebola -----------------------------------------------

# read ebola


```


## Find the reporting delay

What it is?
With which other is related?

The natural history of a disease influence the transmission dynamics. For `{EpiNow2}`, we can specify relevant delay distributions like the [reporting delay](../learners/reference.md#reportingdelay):

![Timeline for chain of disease reporting, the Netherlands. Lab, laboratory; PHA, public health authority. From [MarinoviÄ‡ et al., 2015](https://wwwnc.cdc.gov/eid/article/21/2/13-0504_article)](fig/disease-reporting.jpg)

```{r}
reporting_delay <- dist_spec(
  mean = convert_to_logmean(2, 1), 
  sd = convert_to_logsd(2, 1),
  max = 10, distribution = "lognormal"
)
```

```{r,message=FALSE,warning=FALSE,cache=TRUE}
epinow_estimates <- epinow(
  # cases
  reported_cases = example_confirmed[1:60],
  # delays
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(
    incubation_period + reporting_delay
  ),
  # computation
  stan = stan_opts(
    cores = 4, samples = 1000, chains = 3,
    control = list(adapt_delta = 0.99)
  )
)
```

## formative

```{r}
### 3 add reporting delay --------

# now is your turn!
# after the ebola assessment


```

## From our data! (callout)

estimate serial interval from case and contact data pairs 

ref: https://www.reconlearn.org/post/real-time-response-2

ref: to epimodelac

## concept map

update it from last epiparameter test 

::::::::::::::::::::::::::::::::::::: keypoints 

- Use `{epiparameter}`

::::::::::::::::::::::::::::::::::::::::::::::::


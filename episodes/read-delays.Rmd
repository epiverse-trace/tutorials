---
title: 'Describe case data'
teaching: 10
exercises: 2
---

:::::::::::::::::::::::::::::::::::::: questions 

- how to obtain delay distributions from a literature systematic review?
- what is the natural history of the disease?
- how long should contacts be followed?
- what is the required duration of contact tracing?
- how long should cases be isolated to reduce transmission?

- what are the epidemiological characteristics of the infection?
- what is the demographic distribution of cases?

::::::::::::::::::::::::::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::: objectives

- Explain how to use markdown with the new lesson template
- Demonstrate how to include pieces of code, figures, and nested challenge blocks

::::::::::::::::::::::::::::::::::::::::::::::::

::::::::::::::::::::::::::::::::::::: prereq

## Prerequisites

This episode requires you to be familiar with:

**Data science** : Basic programming with R.

**Epidemic theory** : Epidemiological parameters. Time periods.

This also requires the following package:

```r
if(!require("pak")) install.packages("pak")
pak::pak("epiverse-trace/epiparameter")
```

:::::::::::::::::::::::::::::::::

## Systematic review of Parameters

The [natural history](../learners/reference.md#naturalhistory) of a infectious disease show us that its development has a regularity from stage to stage. The time periods from a infectious disease inform about the timing of transmission and interventions.

![Definition of key time periods. From [Xiang et al, 2021](https://www.sciencedirect.com/science/article/pii/S2468042721000038)](fig/time-periods.jpg)


::::::::::::::::: callout

### Definitions

Take a look at the [glossary](../learners/reference.md) for all the definitions of the time periods of the figure above!

:::::::::::::::::::::::::

However, early in an epidemic, modelling efforts can be delayed by the lack of a centralized resource summarizing input parameters for the disease of interest ([Nash et al., 2023](https://mrc-ide.github.io/epireview/)). Projects like `{epiparameter}` and `{epireview}` are building online catalogs that can help building models faster for coming outbreaks and epidemics from known and unknown pathogens.

<!-- Early models for COVID-19 used parameters from other coronaviruses. -->

Let's explore how we can access to time periods and delays using `{epiparameter}` to plug them in to `{EpiNow2}`:

```{r}
library(epiparameter)
library(EpiNow2)
```


## Find a generation time

The generation time, jointly with the R0, can inform about the speed of spread and its feasibility of control. Given a $R>1$, with a shorter generation time, cases can appear more quickly.

![From the video by MRC Centre for Global Infectious Disease Analysis, Ep 76. Science In Context - Epi Parameter Review Group with Dr Anne Cori (27-07-2023) at <https://youtu.be/VvpYHhFDIjI?si=XiUyjmSV1gKNdrrL>](fig/reproduction-generation-time.png)

<!-- formative -->
<!-- how to assess on? -->
<!-- compare two scenarios -->
<!-- - high R0 and short generation time -->
<!-- - low R0 and long generation time -->

In calculating the effective reproductive number ($Rt$), the generation time distribution is often approximated by the [serial interval](../learners/reference.md#serialinterval) distribution although this can produced biased estimates. ([Knight et al., 2020](https://www.sciencedirect.com/science/article/pii/S2468042720300634?via%3Dihub))

::::::::::::::::::::::::::::::::: challenge

### REVIEW

Let's assume that COVID-19 and SARS has close Reproduction number values. Which one would be harder to control? Why do you conclude that?

![Serial interval of novel coronavirus (COVID-19) infections overlaid with a published distribution of SARS. From [Nishiura et al, 2020](https://www.ijidonline.com/article/S1201-9712(20)30119-3/fulltext)](fig/serial-interval-covid-sars.jpg)

::::::::::::::::: hint

### HINT

The peak of each curve can inform you about the mean each distribution. Larger mean, larger serial interval. 

::::::::::::::::::::::

::::::::::::::::: solution

### SOLUTION

Which one would be harder to control?

- COVID-19

Why do you conclude that?

- COVID-19 has the lowest mean serial interval. The approximate mean value for the serial interval of: 
  - COVID-19 is around 4 days.
  - SARS us around 7 days.

::::::::::::::::::::::::::


:::::::::::::::::::::::::::::::::::::::::::


```{r}
### 1 replace generation time from literature -----

generation_time <- dist_spec(
  mean = 3.6,
  sd = 3.1,
  max = 20,
  distribution = "lognormal"
)

# replace this assuming that this is covid
# with lognormal

epiparameter::epidist_db(
  disease = "covid",
  epi_dist = "serial",
  author = "Nishiura") %>%
  epiparameter::list_distributions()

covid_lnorm <- epiparameter::epidist_db(
  disease = "covid",
  epi_dist = "serial",
  author = "Nishiura",
  single_epidist = T) # not desired

covid_lnorm

covid_lnorm$summary_stats$mean
covid_lnorm_discrete <- epiparameter::discretise(covid_lnorm)
covid_lnorm_discrete_max <- covid_lnorm_discrete$prob_dist$q(p = 0.999)

generation_time_epiparam <- dist_spec(
  mean = covid_lnorm$summary_stats$mean,
  sd = covid_lnorm$summary_stats$sd,
  max = covid_lnorm_discrete_max,
  distribution = "lognormal"
)

epinow_estimates <- epinow(
  # cases
  reported_cases = example_confirmed[1:60],
  # delays
  generation_time = generation_time_opts(generation_time_epiparam),
  # computation
  stan = stan_opts(
    cores = 4, samples = 1000, chains = 3,
    control = list(adapt_delta = 0.99)
  )
)

base::plot(epinow_estimates)
```

## formative

```{r}
# generation time for ebola
# if not, find serial interval and use it as serial interval
```

## Find the incubation time

What it is?
With which other is related?

The natural history of a disease influence the transmission dynamics. For `{EpiNow2}`, we can specify relevant delay distributions like the [incubation period](../learners/reference.md#incubation):

![The relationship between the incubation period and serial interval. From [Nishiura 2020](https://www.ijidonline.com/article/S1201-9712(20)30119-3/fulltext)](fig/incubation-period-serial-interval.jpg)

![Parameter estimates. Plausible ranges for the key parameters R0 and θ (see main text for sources) for four viral infections of public concern are shown as shaded regions. The size of the shaded area reflects the uncertainties in the parameter estimates. [Fraser et al., 2004](https://www.pnas.org/doi/10.1073/pnas.0307506101)](fig/reproduction-number-pre-symptomatic.png)
<!-- fix with screenshot from larger computer monitor -->

<!-- Transmission before symptoms -->
<!-- https://www.thelancet.com/article/S2214-109X(20)30074-7/fulltext -->

<!-- The highest the Reproduction number, more -->
<!-- Required coverage ~duration~ of contact tracing -->
<!-- https://www.thelancet.com/article/S2214-109X(20)30074-7/fulltext -->
<!-- https://royalsocietypublishing.org/doi/10.1098/rstb.2016.0371 -->

```{r}
incubation_period <- dist_spec(
  mean = 4, sd = 2,
  max = 20, distribution = "gamma"
)
```

```{r,message=FALSE,warning=FALSE,cache=TRUE}
epinow_estimates <- epinow(
  # cases
  reported_cases = example_confirmed[1:60],
  # delays
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(incubation_period),
  # computation
  stan = stan_opts(
    cores = 4, samples = 1000, chains = 3,
    control = list(adapt_delta = 0.99)
  )
)
```


```{r}
### 2 include incubation time ------

epiparameter::epidist_db(
  disease = "covid",
  epi_dist = "incubation") %>%
  epiparameter::list_distributions()

covid_incubation <- epiparameter::epidist_db(
  disease = "covid",
  epi_dist = "incubation",
  author = "Natalie",
  single_epidist = T
)

covid_incubation

covid_incubation$summary_stats$mean
covid_incubation_discrete <- epiparameter::discretise(covid_incubation)
covid_incubation_discrete_max <- covid_lnorm_discrete$prob_dist$q(p = 0.999)

incubation_time_epiparam <- dist_spec(
  mean = covid_incubation$summary_stats$mean,
  sd = covid_incubation$summary_stats$sd,
  max = covid_incubation_discrete_max,
  distribution = "lognormal"
)

epinow_estimates <- epinow(
  # cases
  reported_cases = example_confirmed[1:60],
  # generation time
  generation_time = generation_time_opts(generation_time_epiparam),
  # delays
  delays = delay_opts(incubation_time_epiparam),
  # computation
  stan = stan_opts(
    cores = 4, samples = 1000, chains = 3,
    control = list(adapt_delta = 0.99)
  )
)

base::plot(epinow_estimates)

# post calculation questions
# what have changed?
# - cases by date of infection
# - uncertainty

```

## formative

```{r}
# formative, now with ebola -----------------------------------------------

# read ebola


```

Potential biases like

- censoring bias (short periods)
- reporting bias (recent contacts)

## Find the reporting delay

What it is?
With which other is related?

Adjusting for delays

![Rt is a measure of transmission at time t. Observations after time t must be adjusted. ICU, intensive care unit. From  [Gostic et al., 2020](https://journals.plos.org/ploscompbiol/article?id=10.1371/journal.pcbi.1008409#sec007)](fig/rt-adjusting-delays.png)

The natural history of a disease influence the transmission dynamics. For `{EpiNow2}`, we can specify relevant delay distributions like the [reporting delay](../learners/reference.md#reportingdelay):

![Timeline for chain of disease reporting, the Netherlands. Lab, laboratory; PHA, public health authority. From [Marinović et al., 2015](https://wwwnc.cdc.gov/eid/article/21/2/13-0504_article)](fig/disease-reporting.jpg)

```{r}
reporting_delay <- dist_spec(
  mean = convert_to_logmean(2, 1), 
  sd = convert_to_logsd(2, 1),
  max = 10, distribution = "lognormal"
)
```

```{r,message=FALSE,warning=FALSE,cache=TRUE}
epinow_estimates <- epinow(
  # cases
  reported_cases = example_confirmed[1:60],
  # delays
  generation_time = generation_time_opts(generation_time),
  delays = delay_opts(
    incubation_period + reporting_delay
  ),
  # computation
  stan = stan_opts(
    cores = 4, samples = 1000, chains = 3,
    control = list(adapt_delta = 0.99)
  )
)
```

## formative

```{r}
### 3 add reporting delay --------

# now is your turn!
# after the ebola assessment


```

## Severity parameters

The three examples above represent transmission parameters.

- Duration of hospitalization (bed capacity needed)

## From our data! (callout)

Fit a parametric distribution to estimate the mean and sd

estimate serial interval from case and contact data pairs 

ref: https://www.reconlearn.org/post/real-time-response-2

ref: https://epiverse-trace.github.io/epimodelac/EnfermedadX.html

## concept map

update it from last epiparameter test 

::::::::::::::::::::::::::::::::::::: keypoints 

- Use `{epiparameter}`

::::::::::::::::::::::::::::::::::::::::::::::::

